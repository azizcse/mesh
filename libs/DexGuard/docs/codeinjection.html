



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for the DexGuard tool">
      
      
      
        <meta name="author" content="Guardsquare">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="img/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.3">
    
    
      
        <title>Codeinjection - DexGuard</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7C&display=fallback">
        <style>body,input{font-family:"","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="css/extra.css">
    
      <link rel="stylesheet" href="css/extra2.css">
    
      <link rel="stylesheet" href="css/tabs.css">
    
    
      
    
    
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NMXSB9');</script>
<!-- End Google Tag Manager -->


  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#introduction" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NMXSB9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
   
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="DexGuard" aria-label="DexGuard" class="md-header-nav__button md-logo">
          
            <img alt="logo" src="img/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              DexGuard
            </span>
            <span class="md-header-nav__topic">
              
                Codeinjection
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    

    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="DexGuard" class="md-nav__button md-logo">
      
        <img alt="logo" src="img/logo.png" width="48" height="48">
      
    </a>
    DexGuard
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="quickstart.html" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="introduction.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Setup
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="setup/standalone.html" title="DexGuard" class="md-nav__link">
      DexGuard
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="setup/upgrading.html" title="Upgrading" class="md-nav__link">
      Upgrading
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="setup/gradle-plugin.html" title="Gradle Plugin" class="md-nav__link">
      Gradle Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="setup/repository.html" title="Maven repository" class="md-nav__link">
      Maven repository
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="setup/espresso.html" title="Espresso" class="md-nav__link">
      Espresso
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="setup/cordovaplugin.html" title="Cordova Plugin" class="md-nav__link">
      Cordova Plugin
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Configuration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Configuration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="configuration.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="usage.html" title="Reference Guide" class="md-nav__link">
      Reference Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="defaultconfigurations.html" title="Default Configs" class="md-nav__link">
      Default Configs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="annotations.html" title="Annotations" class="md-nav__link">
      Annotations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Features
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Features
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="protection.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="rasp.html" title="RASP" class="md-nav__link">
      RASP
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Languages & Platforms
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Languages & Platforms
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="java.html" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="kotlin.html" title="Kotlin" class="md-nav__link">
      Kotlin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="javascript.html" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      ThreatCast
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        ThreatCast
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="threatcast.html" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      In Depth
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        In Depth
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="protectionreport.html" title="Protection Report" class="md-nav__link">
      Protection Report
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="examples.html" title="Examples" class="md-nav__link">
      Examples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="refcard.html" title="Reference Card" class="md-nav__link">
      Reference Card
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="optimizations.html" title="Optimizations" class="md-nav__link">
      Optimizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="attributes.html" title="Attributes" class="md-nav__link">
      Attributes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="loggingremoval.html" title="Logging Removal" class="md-nav__link">
      Logging Removal
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="verification.html" title="Verification" class="md-nav__link">
      Verification
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="runtime.html" title="Runtime Library" class="md-nav__link">
      Runtime Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="plugins.html" title="Encryption Plugins" class="md-nav__link">
      Encryption Plugins
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Addons
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Addons
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="addons_overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="ndk.html" title="NDK" class="md-nav__link">
      NDK
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="whitebox.html" title="Whitebox Cryptography" class="md-nav__link">
      Whitebox Cryptography
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="fingerprinting.html" title="Device Fingerprinting" class="md-nav__link">
      Device Fingerprinting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="securekeyboard.html" title="Secure Keyboard" class="md-nav__link">
      Secure Keyboard
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="tools/androidstudio.html" title="Android Studio Plugin" class="md-nav__link">
      Android Studio Plugin
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="tools/libraryrulesgenerator.html" title="Library Rules Generator" class="md-nav__link">
      Library Rules Generator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="tools/retrace.html" title="ReTrace" class="md-nav__link">
      ReTrace
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="troubleshooting.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="reportingissues.html" title="Reporting Issues" class="md-nav__link">
      Reporting Issues
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="releasenotes.html" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="license.html" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-define" class="md-nav__link">
    -define
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#predefined-variables" class="md-nav__link">
    Predefined variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-inject" class="md-nav__link">
    -inject
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggressiveness" class="md-nav__link">
    Aggressiveness
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#obfuscation" class="md-nav__link">
    Obfuscation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#code-containers" class="md-nav__link">
    Code containers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameter-mapping" class="md-nav__link">
    Parameter mapping
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one-to-one" class="md-nav__link">
    one-to-one
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#named-mapping" class="md-nav__link">
    named mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#value-mapping" class="md-nav__link">
    value mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixing-named-and-value-mappings" class="md-nav__link">
    mixing named and value mappings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#default-values-for-mappings" class="md-nav__link">
    default values for mappings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references-in-source-injection-code" class="md-nav__link">
    References in source injection code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-creation" class="md-nav__link">
    Method creation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Codeinjection</h1>
                
                <h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Using an inject configuration DexGuard is able to inject code into a method in your application. There are three
configuration options that are used for code injection: <code>-define</code>, <code>-inject</code> and <code>-create</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature is not final and subject to change.</p>
</div>
<h2 id="-define">-define<a class="headerlink" href="#-define" title="Permanent link">&para;</a></h2>
<p>The <code>-define</code> configuration option can be used to define variables that can later be used during code injection. This is useful,
for example, to define a default configuration with some optional values.</p>
<div class="codehilite"><pre><span></span><code>-define[,encrypt|const] varName varValue [or defaultVarValue]
</code></pre></div>


<p>Notes:</p>
<ul>
<li>Variable names follow the same rules as for Java identifier names, but they cannot start with <code>$</code>.</li>
<li>To refer to variables later, prefix the variable name with $.</li>
<li>Variable values can be one of the following types:<ul>
<li>boolean - <code>true</code> or <code>false</code></li>
<li>number e.g. <code>6</code> (integer), <code>6.6</code> (double)</li>
<li>string (must be in quotes) e.g. <code>"my string"</code>, <code>'my string'</code>, <code>"my \"quoted\" string"</code></li>
<li>system property value e.g. <code>&lt;mySystemProperty&gt;</code></li>
<li>another variable e.g. <code>$myOtherVar</code></li>
<li>class filter e.g. <code>class mypackage.** extends android.content.ContextWrapper</code></li>
</ul>
</li>
<li>Default values are used if the first value is undefined (e.g. a system property is undefined).  <ul>
<li>If the value is undefined and there is no default an error occurs.</li>
<li>Default values must have the same type as the value. </li>
</ul>
</li>
<li>Definitions using the const modifier cannot be re-defined later.</li>
<li>Strings (and only strings) can be encrypted using <code>encrypt</code> modifier.</li>
<li>System properties are parsed using the same rules, so you can for example, put a class filter in a system property
 and use it as the <code>into</code> class-filter in an <code>-inject</code> configuration.</li>
<li>Arrays of values are defined between <code>(</code> and <code>)</code> e.g. <code>(1, 2, 3)</code>, <code>("file1.txt", "file2.txt")</code>.</li>
</ul>
<p>Definitions are evaluated during the configuration parsing stage so to refer to a variable from another <code>-define</code> option it
must have already been defined or a default value provided.</p>
<h3 id="predefined-variables">Predefined variables<a class="headerlink" href="#predefined-variables" title="Permanent link">&para;</a></h3>
<p>The following are predefined constants: </p>
<ul>
<li><code>dexguardVersion</code>    - the version of DexGuard used.</li>
<li><code>dexguardSignature</code> - the signature of DexGuard used.</li>
</ul>
<p>The following are predifined variables:</p>
<ul>
<li><code>injectId</code> - a unique ID (32-bit signed int) that is generated for each injection.</li>
</ul>
<h3 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>-define x 1
-define y &quot;hello&quot;
-define z &lt;mySystemProperty&gt; or &quot;default value&quot;
-define x 2 # Re-define x as 2.
-define y 2.0 # Error because y was defined as a string.
-define a 6.6
-define myArray (1, 2, 3)

-define,const myConst 1
-define myConst 2 # Error because myConst is a constant.

-define,encrypt hello &quot;hello&quot; # The string will be encrypted.
-define,encrypt helloArray (&quot;hello&quot;, &quot;hi&quot;, &quot;halo&quot;) # Arrays of strings can also be encrypted.

-define myFilter &lt;myFilter&gt; # filter parsed from system property.
-define defaultFilter $myFilter or class mypackage.** # use either the filter
                                                      # from $myFilter or the default value.

-define myFilter class mypackage.**
-define anotherFilter $myFilter or 1 # Error because the default value 
                                     # is a number but the value is a class filter.

-define myArray (1, &quot;hello&quot;, 2) # Error as you cannot mix types in an array

-define v1 $v0 # Error as $v0 is not yet defined.
-define v0 1
-define v3 $v2 or 2 # $v2 is not defined but it&#39;s OK because there&#39;s a default value.
</code></pre></div>

<h2 id="-inject">-inject<a class="headerlink" href="#-inject" title="Permanent link">&para;</a></h2>
<p>You can select code to inject using the <code>-inject</code> configuration option. This option allows you to choose
where the source of the code to be injected is, what the targets are, and map parameters from the target 
to the injected code. The <code>-inject</code> option uses <a href="usage.html#classspecification">class specifications</a> to define
the source and target locations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Code is injected at the beginning of a method.</p>
</div>
<p>The basic format of the <code>-inject</code> option is:</p>
<div class="codehilite"><pre><span></span><code>-inject[,aggressiveness|obfuscate] from [jar filename;] class-filter {
    method-specification
} into [class-filter|$variable] {
    method-specification*
}
</code></pre></div>


<p>The <code>from</code> <a href="usage.html#classspecification">class specification</a> is the location of the code to be injected; this is a 
restricted class specification that cannot contain wildcards and can contain only one member specification.</p>
<p>The <code>into</code> <a href="usage.html#classspecification">class specification</a> is the target location where the code will be injected into; it can contain wildcards.
 The class filter part of the <code>into</code> specification can be either a class-filter or a variable containing a class-filter: </p>
<div class="codehilite"><pre><span></span><code>-define myClassFilter class mypackage.** extends android.content.Context

-inject from class mypackage.MyClass {
     public void sourceMethod(java.lang.String, java.lang.String);
 } into $myClassFilter {
     public void targetMethod(...);
 }
</code></pre></div>


<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use wildcards, for example, to inject some code into any method that has some specific parameter type such as an integer.
You can then use a mapping to map the parameter to the injected code.</p>
</div>
<h3 id="aggressiveness">Aggressiveness<a class="headerlink" href="#aggressiveness" title="Permanent link">&para;</a></h3>
<p>The aggressiveness modifier is a value determining how many methods the code should be injected into - one of <code>min</code>, <code>low</code>, <code>medium</code>, <code>high</code>, <code>max</code>, <code>all</code>. By
default the code will be injected into all matching methods (<code>all</code>).</p>
<h3 id="obfuscation">Obfuscation<a class="headerlink" href="#obfuscation" title="Permanent link">&para;</a></h3>
<p>The <code>obfuscate</code> modifier marks the method for obfuscation regardless of whether the method would have been obfuscated or not anyway.</p>
<h3 id="code-containers">Code containers<a class="headerlink" href="#code-containers" title="Permanent link">&para;</a></h3>
<p>The source of the injected code can be either a jar file or from one of the program's own classes; by default,
if you don't specify the <code>jar</code> option the code will be taken the program's own classes.</p>
<h3 id="parameter-mapping">Parameter mapping<a class="headerlink" href="#parameter-mapping" title="Permanent link">&para;</a></h3>
<p>You can map parameters from the source code to the target code using a parameter mapping; by default there is no mapping 
and any parameters in your source method will be assigned a default value (e.g. null for objects, 0 for integers).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can map parameters to "weave" the injected code into the original code - making the newly injected code depend on
the original code.</p>
</div>
<p>If the descriptors of the source and target method are the same you can use a <code>one-to-one</code> mapping which maps each parameter
of your target method to the corresponding source method parameter.</p>
<p>If the descriptors don't match then you can create a <code>named mapping</code> which allows you to name the parameters in the source
method and map them to target method parameters.</p>
<p>You can also use literal values or variables as parameters for your injected code. If you don't care about a particular parameter you can name it <code>*</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The variables used in an <code>-inject</code> configuration do not have to be declared already, as they 
are evaluated during the code injection phase after all the <code>-define</code> configuration options. If you re-declare a variable more than 
once the last value of the variable will be used even if the re-declaration comes after the <code>-inject</code> in the configuration file.</p>
</div>
<h4 id="one-to-one">one-to-one<a class="headerlink" href="#one-to-one" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code># Any code using the first parameter in sourceMethod will 
# now refer to the first parameter in targetMethod.

-inject from class mypackage.MyClass {
    public void sourceMethod(java.lang.String);
} into class mypackage.MyOtherClass {
    public void targetMethod(java.lang.String);
} withmapping one-to-one
</code></pre></div>


<h4 id="named-mapping">named mapping<a class="headerlink" href="#named-mapping" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code># Any code using the first parameter in sourceMethod will
# now refer to the second parameter in targetMethod.

-inject from class mypackage.MyClass {
    public void sourceMethod(java.lang.String);
} into class mypackage.MyOtherClass {
    public void targetMethod(int, java.lang.String);
} withmapping (s) {
    (*, s);
}
</code></pre></div>


<h4 id="value-mapping">value mapping<a class="headerlink" href="#value-mapping" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code># Provide values instead of a named mapping:
#
# Any code using the first parameter in sourceMethod
# will now have the value &quot;my string&quot; and
# any code using the second parameter in sourceMethod
# will now have the value &quot;my other string&quot;.

-define myVariable &quot;my string&quot;

-inject from class mypackage.MyClass {
    public void sourceMethod(java.lang.String, java.lang.String);
} into class mypackage.MyOtherClass {
    public void targetMethod(...);
} withmapping ($myVariable, &quot;my other string&quot;)

# Note that arrays are not supported as literal value mappings, only variable value mappings.
</code></pre></div>


<h4 id="mixing-named-and-value-mappings">mixing named and value mappings<a class="headerlink" href="#mixing-named-and-value-mappings" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>-define myVariable &quot;my string&quot;

# Any code using the first parameter in sourceMethod
# will now have the value &quot;my string&quot; and
# Any code using the second parameter in sourceMethod will
# now refer to the first parameter in targetMethod using the first mapping.

-inject from class mypackage.MyClass {
    public void sourceMethod(java.lang.String, java.lang.String);
} into class mypackage.MyOtherClass {
    public void targetMethod(java.lang.String, int);
} withmapping ($myVariable, secondStringParam) {
    (secondStringParam, *);
}
</code></pre></div>


<h4 id="default-values-for-mappings">default values for mappings<a class="headerlink" href="#default-values-for-mappings" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>-define myVariable &quot;my string&quot;

# Any code using the first parameter in sourceMethod
# will now have the value &quot;my string&quot; and
# Any code using the second parameter in sourceMethod will
# now refer to the first parameter in targetMethod using the first mapping.
# Any code using the second parameter in sourceMethod will
# now have the value &quot;my other string&quot; using the second mapping, as the
# default value of &quot;my other string&quot; is used.

-inject from class mypackage.MyClass {
    public void sourceMethod(java.lang.String, java.lang.String);
} into class mypackage.MyOtherClass {
    public void targetMethod(java.lang.String, int);
    public void targetMethod(java.lang.String, int);
} withmapping ($myVariable, secondStringParam = &quot;my other string&quot;) {
    (secondStringParam, *);
    (*, *);
}
</code></pre></div>


<h3 id="references-in-source-injection-code">References in source injection code<a class="headerlink" href="#references-in-source-injection-code" title="Permanent link">&para;</a></h3>
<p>If both the source method and target method are instance methods, then the <code>this</code> parameter is mapped i.e. any use of
<code>this</code> in your source method will now refer to <code>this</code> in the target method.</p>
<p>Class references will be updated when they refer to the original class or its ancestors, for example:</p>
<div class="codehilite"><pre><span></span><code>-inject from class Source {
    public void sourceMethod();
} into class Target {
    public void targetMethod();
}

class Source {
    public void callMe() {
        System.out.println(&quot;SOURCE&quot;);
    }

    public void sourceMethod() {
        this.callMe();
    }
}

class Target {
    public void callMe() {
        System.out.println(&quot;TARGET&quot;);
    }

    public void targetMethod() {
        System.out.println(&quot;ORIGINAL&quot;);
    }

    public static void main(String[] args) {
        (new Target()).targetMethod();
    }
}
</code></pre></div>


<p>Executing <code>Target.main(String[])</code> after injection will print:</p>
<div class="codehilite"><pre><span></span><code>TARGET
ORIGINAL
</code></pre></div>


<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Declare stub methods in your source class that match existing methods in your target class to call existing methods 
from your injection source code.</p>
</div>
<h3 id="method-creation">Method creation<a class="headerlink" href="#method-creation" title="Permanent link">&para;</a></h3>
<p>You can use the <code>-create</code> configuration option to create methods. For example, if you wanted to inject code into Android
 onPause() Lifecycle methods you can optionally create them, as they're not required to be implemented, so they may not exist already.</p>
<div class="codehilite"><pre><span></span><code>-create method in class ** extends android.content.ContextWrapper {
    public void onPause();
}
</code></pre></div>


<p>If you need to call the super method (as in the case with Android Lifecycle methods) you can do so with <code>callsuper</code> and an optional mapping (similar to code injection):</p>
<div class="codehilite"><pre><span></span><code>-create method in class ** extends android.content.ContextWrapper {
    public void onPause();
} callsuper withmapping one-to-one
</code></pre></div>


<p>In this particular case, the mapping is optional as there are no parameters. You can use a one-to-one mapping, named mapping
or value mapping just like the code injection mappings. </p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 Guardsquare
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/guardsquare" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/company/guardsquare-nv" target="_blank" rel="noopener" title="linkedin" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://www.facebook.com/guardsquare" target="_blank" rel="noopener" title="facebook" class="md-footer-social__link fa fa-facebook"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>